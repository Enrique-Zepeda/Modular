# ğŸš€ Reglas y Mejores PrÃ¡cticas - React + TypeScript + Supabase

## ğŸ“ Estructura y OrganizaciÃ³n

### Estructura de Carpetas
- MantÃ©n la estructura actual: `src/features/`, `src/components/`, `src/pages/`, `src/hooks/`, `src/store/`, `src/supabase/`
- Usa `features/` para lÃ³gica de negocio especÃ­fica (auth, ejercicios, etc.)
- MantÃ©n `components/` para componentes reutilizables
- Usa `pages/` para componentes de pÃ¡gina completos

### Nomenclatura
- **Archivos**: PascalCase para componentes (`AuthProvider.tsx`)
- **Carpetas**: camelCase para features (`auth/`, `ejercicios/`)
- **Variables y funciones**: camelCase
- **Constantes**: UPPER_SNAKE_CASE
- **Interfaces/Types**: PascalCase con prefijo `I` para interfaces (`IUser`)

## âš›ï¸ React y TypeScript

### Componentes
```typescript
// âœ… Correcto
interface IComponentProps {
  title: string;
  onAction?: () => void;
}

const Component: React.FC<IComponentProps> = ({ title, onAction }) => {
  return <div>{title}</div>;
};
```

### Hooks Personalizados
- Nombra con prefijo `use` (`useAuth`, `useSupabase`)
- Retorna objetos tipados
- Maneja estados de loading y error

### TypeScript
- Define interfaces para todas las entidades de Supabase
- Usa `Partial<T>` para props opcionales
- Evita `any`, usa `unknown` si es necesario
- Define tipos para respuestas de API

## ğŸ”„ Redux Toolkit

### Slices
```typescript
// âœ… Estructura recomendada
interface IAuthState {
  user: IUser | null;
  isLoading: boolean;
  error: string | null;
}

const initialState: IAuthState = {
  user: null,
  isLoading: false,
  error: null,
};
```

### Async Thunks
- Usa `createAsyncThunk` para operaciones asÃ­ncronas
- Maneja estados pending, fulfilled, rejected
- Usa `extraReducers` para casos especÃ­ficos

## ğŸ—„ï¸ Supabase

### Cliente Supabase
- MantÃ©n una instancia Ãºnica en `src/supabase/client.ts`
- Usa variables de entorno para URLs y keys
- Implementa manejo de errores consistente

### Operaciones de Base de Datos
```typescript
// âœ… PatrÃ³n recomendado
export const fetchUser = async (userId: string): Promise<IUser> => {
  const { data, error } = await supabase
    .from('Usuarios')
    .select('*')
    .eq('id_usuario', userId)
    .single();
  
  if (error) throw new Error(error.message);
  return data;
};
```

### RLS (Row Level Security)
- Habilita RLS en todas las tablas sensibles
- Define polÃ­ticas especÃ­ficas por usuario
- Usa `auth.uid()` para filtros de usuario

## ğŸ¨ UI/UX con shadcn/ui

### Componentes UI
- Usa componentes de shadcn/ui como base
- Extiende con `class-variance-authority` para variantes
- MantÃ©n consistencia en spacing y colors

### Styling
```typescript
// âœ… Usando CVA
const buttonVariants = cva(
  "inline-flex items-center justify-center rounded-md text-sm font-medium",
  {
    variants: {
      variant: {
        default: "bg-primary text-primary-foreground hover:bg-primary/90",
        destructive: "bg-destructive text-destructive-foreground hover:bg-destructive/90",
      },
      size: {
        default: "h-10 px-4 py-2",
        sm: "h-9 rounded-md px-3",
        lg: "h-11 rounded-md px-8",
      },
    },
    defaultVariants: {
      variant: "default",
      size: "default",
    },
  }
);
```

## ğŸ›£ï¸ Routing

### React Router
- Usa rutas protegidas para pÃ¡ginas privadas
- Implementa lazy loading para optimizaciÃ³n
- Maneja rutas 404 apropiadamente

### ProtecciÃ³n de Rutas
```typescript
// âœ… PatrÃ³n para rutas protegidas
const ProtectedRoute: React.FC<{ children: React.ReactNode }> = ({ children }) => {
  const { user, isLoading } = useAuth();
  
  if (isLoading) return <LoadingSpinner />;
  if (!user) return <Navigate to="/login" />;
  
  return <>{children}</>;
};
```

## ğŸ“ Formularios

### React Hook Form + Zod
```typescript
// âœ… ValidaciÃ³n con Zod
const loginSchema = z.object({
  email: z.string().email('Email invÃ¡lido'),
  password: z.string().min(6, 'MÃ­nimo 6 caracteres'),
});

type LoginForm = z.infer<typeof loginSchema>;
```

### Manejo de Estados
- Usa `useState` para estado local simple
- Usa `useReducer` para estado complejo
- Usa Redux para estado global compartido

## ğŸ”’ Seguridad

### AutenticaciÃ³n
- Implementa refresh tokens
- Maneja logout en mÃºltiples pestaÃ±as
- Valida tokens en cada request

### ValidaciÃ³n
- Valida datos en frontend y backend
- Sanitiza inputs de usuario
- Usa CSRF tokens cuando sea necesario

## âš¡ Performance

### OptimizaciÃ³n
- Usa `React.memo()` para componentes costosos
- Implementa lazy loading para rutas
- Optimiza imÃ¡genes y assets
- Usa `useMemo` y `useCallback` apropiadamente

### Code Splitting
```typescript
// âœ… Lazy loading
const Dashboard = lazy(() => import('./pages/Dashboard'));
const Login = lazy(() => import('./pages/Login'));
```

## ğŸ§ª Testing y Calidad

### ESLint
- MantÃ©n reglas estrictas de TypeScript
- Usa `eslint-plugin-react-hooks`
- Configura reglas especÃ­ficas para tu proyecto

### Manejo de Errores
```typescript
// âœ… Error Boundary
class ErrorBoundary extends Component {
  componentDidCatch(error: Error, errorInfo: ErrorInfo) {
    console.error('Error:', error, errorInfo);
    // Enviar a servicio de monitoreo
  }
}
```

## ğŸ“± Responsive y Accesibilidad

### Mobile First
- DiseÃ±a para mobile primero
- Usa breakpoints de Tailwind consistentemente
- Prueba en diferentes dispositivos

### Accesibilidad
- Usa `aria-*` attributes apropiadamente
- Implementa navegaciÃ³n por teclado
- MantÃ©n contraste de colores adecuado

## ğŸš€ Deployment

### Variables de Entorno
```env
VITE_SUPABASE_URL=your_supabase_url
VITE_SUPABASE_ANON_KEY=your_anon_key
```

### Build Optimization
- Usa `vite` para builds rÃ¡pidos
- Configura tree shaking
- Optimiza bundle size

## ğŸ“Š Monitoreo y Analytics

### Logging
- Implementa logging estructurado
- Usa diferentes niveles (debug, info, warn, error)
- Integra con servicios de monitoreo

### Analytics
- Trackea eventos importantes
- Mide performance de componentes
- Monitorea errores de usuario

## ğŸ”„ Desarrollo Continuo

### Git Workflow
- Usa conventional commits
- MantÃ©n branches limpios
- Code review obligatorio

### DocumentaciÃ³n
- Documenta componentes complejos
- MantÃ©n README actualizado
- Documenta APIs y tipos

## ğŸ¯ Reglas EspecÃ­ficas del Proyecto

### Base de Datos (Supabase)
- Tabla `Usuarios`: Maneja autenticaciÃ³n y perfiles
- Tabla `Rutinas`: CatÃ¡logo de rutinas disponibles
- Tabla `Ejercicios`: CatÃ¡logo de ejercicios
- Tabla `ProgresoDeUsuario`: Seguimiento de progreso
- Tabla `Programas`: Programas de entrenamiento
- Tabla `recomendacionesia`: Recomendaciones de IA
- Tabla `feedbackusuario`: Feedback de usuarios

### TecnologÃ­as EspecÃ­ficas
- **React 19**: Usa las Ãºltimas features
- **TypeScript**: Tipado estricto siempre
- **Redux Toolkit**: Estado global
- **React Router DOM**: NavegaciÃ³n
- **React Hook Form + Zod**: Formularios
- **Tailwind CSS**: Styling
- **shadcn/ui**: Componentes UI
- **Lucide React**: Iconos
- **React Hot Toast**: Notificaciones
- **SweetAlert2**: Alertas avanzadas
- **Motion**: Animaciones

### Patrones de CÃ³digo
- Usa composiciÃ³n sobre herencia
- Implementa principios SOLID
- MantÃ©n funciones puras cuando sea posible
- Usa TypeScript strict mode
- Implementa error boundaries
- Usa React.memo() para optimizaciÃ³n

### Estructura de Archivos
```
src/
â”œâ”€â”€ components/          # Componentes reutilizables
â”‚   â”œâ”€â”€ ui/            # Componentes de shadcn/ui
â”‚   â””â”€â”€ AuthProvider.tsx
â”œâ”€â”€ features/           # LÃ³gica de negocio
â”‚   â”œâ”€â”€ auth/          # AutenticaciÃ³n
â”‚   â””â”€â”€ ejercicios/    # GestiÃ³n de ejercicios
â”œâ”€â”€ pages/             # PÃ¡ginas completas
â”œâ”€â”€ hooks/             # Hooks personalizados
â”œâ”€â”€ store/             # Redux store
â”œâ”€â”€ supabase/          # Cliente y operaciones de Supabase
â”œâ”€â”€ routes/            # ConfiguraciÃ³n de rutas
â””â”€â”€ types/             # Definiciones de tipos
```

## ğŸš¨ Reglas CrÃ­ticas

1. **NUNCA** expongas tokens de Supabase en el cÃ³digo
2. **SIEMPRE** valida datos de entrada
3. **SIEMPRE** maneja errores de forma elegante
4. **NUNCA** uses `any` en TypeScript
5. **SIEMPRE** usa tipos para props de componentes
6. **SIEMPRE** implementa loading states
7. **NUNCA** hagas requests sin manejo de errores
8. **SIEMPRE** usa RLS en tablas sensibles
9. **SIEMPRE** documenta funciones complejas
10. **NUNCA** commits cÃ³digo sin testing

## ğŸ“‹ Checklist de Calidad

- [ ] Tipos TypeScript definidos
- [ ] Manejo de errores implementado
- [ ] Loading states configurados
- [ ] Responsive design aplicado
- [ ] Accesibilidad verificada
- [ ] Performance optimizada
- [ ] Tests escritos (si aplica)
- [ ] DocumentaciÃ³n actualizada
- [ ] ESLint sin errores
- [ ] Build exitoso

## ğŸ¨ GuÃ­a de Estilo

### Colores (Tailwind)
- Primary: `bg-primary`, `text-primary`
- Secondary: `bg-secondary`, `text-secondary`
- Accent: `bg-accent`, `text-accent`
- Destructive: `bg-destructive`, `text-destructive`

### Espaciado
- Usa el sistema de espaciado de Tailwind
- MantÃ©n consistencia en padding/margin
- Usa `space-x-*` y `space-y-*` para espaciado entre elementos

### TipografÃ­a
- Usa la jerarquÃ­a de headings apropiadamente
- MantÃ©n consistencia en tamaÃ±os de fuente
- Usa `font-medium`, `font-semibold` para Ã©nfasis

### Animaciones
- Usa `motion` para animaciones complejas
- Usa transiciones CSS para animaciones simples
- MantÃ©n animaciones sutiles y profesionales

## ğŸ”§ ConfiguraciÃ³n Recomendada

### ESLint
```javascript
// Reglas especÃ­ficas para el proyecto
{
  "rules": {
    "@typescript-eslint/no-explicit-any": "error",
    "@typescript-eslint/explicit-function-return-type": "warn",
    "react-hooks/exhaustive-deps": "error",
    "react-hooks/rules-of-hooks": "error"
  }
}
```

### TypeScript
```json
{
  "compilerOptions": {
    "strict": true,
    "noImplicitAny": true,
    "noUnusedLocals": true,
    "noUnusedParameters": true
  }
}
```

## ğŸ“š Recursos Ãštiles

- [React Documentation](https://react.dev/)
- [TypeScript Handbook](https://www.typescriptlang.org/docs/)
- [Supabase Documentation](https://supabase.com/docs)
- [Redux Toolkit Guide](https://redux-toolkit.js.org/)
- [shadcn/ui Components](https://ui.shadcn.com/)
- [Tailwind CSS](https://tailwindcss.com/)
- [React Hook Form](https://react-hook-form.com/)
- [Zod Documentation](https://zod.dev/)

---

**Recuerda**: Estas reglas estÃ¡n diseÃ±adas para mantener la calidad, escalabilidad y mantenibilidad de tu aplicaciÃ³n. Sigue estas prÃ¡cticas consistentemente para crear un cÃ³digo robusto y profesional.
description:
globs:
alwaysApply: false
---
